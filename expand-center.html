<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cytopia: Expand Center Sprites</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="Doc-styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="cytopia_icon_iso.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cytopia
   &#160;<span id="projectnumber">0.3</span>
   </div>
   <div id="projectbrief">A city building simulation game</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('expand-center.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Expand Center Sprites </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#expand-center-idea">Idea</a></li>
<li class="level1"><a href="#expand-center-algorithm">Algorithm</a></li>
<li class="level1"><a href="#expand-center-example">Example</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="expand-center-idea"></a>
Idea</h1>
<p>The sprites we create have a fixed width and height. This is an issue because we want our user interface to be resizable and fit many different dimension layouts. In order to support this, we need the ability to resize sprites without scaling them. This can be done with an expansion algorithm. The main idea is that we will take the middle cross of the sprite and repeat those pixels continuously where expanding would lead to missing pixels.</p>
<h1><a class="anchor" id="expand-center-algorithm"></a>
Algorithm</h1>
<p>Let \(O:n\times m\) be a buffer of pixels of the original sprite and let \(D:a\times b\) be the destination buffer. The generator "cross" are pixels </p><p class="formulaDsp">
\[ C=\left\{O[x,y]\mid x=\left\lfloor\frac{m}{2}\right\rfloor\vee y=\left\lfloor\frac{n}{2}\right\rfloor\right\} \]
</p>
<p>Let's define the projection of a pixel on the generating cross as: </p><p class="formulaDsp">
\[ \Phi(x, x_{min}, x_{max}) = \begin{cases} x &amp; \mathrm{if}\ x\leq x_{min}\\ x_{min} &amp; \mathrm{if}\ x_{min}&lt; x\leq x_{max}\\ x - x_{max} + x_{min} &amp; \mathrm{otherwise} \end{cases} \]
</p>
<p>Then we map the pixels in the following way: </p><p class="formulaDsp">
\[ D[i,j]= O\left[\Phi\left(i, \left\lfloor\frac{n}{2}\right\rfloor, a-\left\lfloor\frac{n}{2}\right\rfloor\right), \Phi\left(j,\left\lfloor\frac{m}{2}\right\rfloor,\left\lfloor\frac{m}{2}\right\rfloor\right)\right] \]
</p>
<h1><a class="anchor" id="expand-center-example"></a>
Example</h1>
<p>Upload your sprite to test the algorithm. </p>
<input type="file" id="Upload-Expand-Center" onchange="UploadExpandCenterPicture()" /><br />
Width: <input id="ExpandWidth" value="100" onchange="UploadExpandCenterPicture()" /><br />
Height: <input id="ExpandHeight" value="100" onchange="UploadExpandCenterPicture()" /><br />
Scale: <input id="ExpandRadius" value="5" onchange="UploadExpandCenterPicture()" /><br />
<center>
<canvas id="ExpandedImage" width="0" height="0" /></center>
<script>

 var canvas = document.getElementById("ExpandedImage");
 var ctx = canvas.getContext("2d");
 var imageData, expand_width, expand_height, expand_radius;


function UploadExpandCenterPicture() {
 file = document.getElementById("Upload-Expand-Center").files[0];
 expand_width = Number(document.getElementById("ExpandWidth").value);
 expand_height = Number(document.getElementById("ExpandHeight").value);
 expand_radius = Number(document.getElementById("ExpandRadius").value);
 if(FileReader) {
   let fr = new FileReader();
   fr.onload = () => showImage(fr);
   fr.readAsDataURL(file);
 }
}

function showImage(fileReader) {
 let img = new Image();
 img.onload = () => getImageData(img);
 img.src = fileReader.result;
}

function getImageData(img) {
 canvas.width = img.width;
 canvas.height = img.height;
 ctx.drawImage(img, 0, 0);
 imageData = ctx.getImageData(0, 0, img.width, img.height);
 imageData = scale(imageData, canvas.width * expand_radius, canvas.height * expand_radius);
 imageData = NNExpand(imageData);
 canvas.width = imageData.width;
 canvas.height = imageData.height;
 ctx.putImageData(imageData, 0, 0);
}

function NNExpand(base) {
  console.log(base);
  let img = new ImageData(expand_width, expand_height);
  let min_x = Math.floor(base.width / 2);
  let max_x = img.width - min_x - (base.width % 2);
  let min_y = Math.floor(base.height / 2);
  let max_y = img.height - min_y - (base.height % 2);
  console.log("Width: ", img.width);
  console.log("Height: ", img.height);
  console.log("min_x: ", min_x);
  console.log("max_x: ", max_x);
  console.log("min_y: ", min_y);
  console.log("max_y: ", max_y);
  console.log("Data: ", base.data);
  for(var i = 0; i < img.width; i++) {
    for(var j = 0; j < img.height; j++) {
      let x = i, y = j;
      if(x >= min_x && x < max_x) {
        x = min_x;
      } else if(x >= max_x) {
         x -= max_x;
         x += min_x;
      }
      if(y >= min_y && y < max_y) {
         y = min_y;
      } else if(y >= max_y) {
         y -= max_y;
         y += min_y;
      }
      img.data[4 * (i + j * img.width) + 0] = base.data[4 * (x + y * base.width) + 0];
      img.data[4 * (i + j * img.width) + 1] = base.data[4 * (x + y * base.width) + 1];
      img.data[4 * (i + j * img.width) + 2] = base.data[4 * (x + y * base.width) + 2];
      img.data[4 * (i + j * img.width) + 3] = base.data[4 * (x + y * base.width) + 3];
    }
  }
  console.log("Finished: ", img.data);
  return img;
}

function scale(base, width, height) {
  let img = new ImageData(width, height);
  for(var i = 0; i < width * height; i++) {
    let x = Math.floor((i % width) * base.width / width),
        y = Math.floor(i  * base.width / width / width);  
    img.data[4 * i + 0] = base.data[4 * (x + y * base.width) + 0];
    img.data[4 * i + 1] = base.data[4 * (x + y * base.width) + 1];
    img.data[4 * i + 2] = base.data[4 * (x + y * base.width) + 2];
    img.data[4 * i + 3] = base.data[4 * (x + y * base.width) + 3];
  }
  return img;
}
</script>
 </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Dec 21 2020 14:20:09 for Cytopia by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
